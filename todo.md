To make this testable, you will need to create a mock for requests and also deal with the behaviour of time.time() which is also non-deterministic.